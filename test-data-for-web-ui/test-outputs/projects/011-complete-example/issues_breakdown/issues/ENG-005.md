# Profile Settings Frontend UI

**Issue ID**: ENG-005  
**Project**: User Profile Management (#011)  
**Status**: Pending  
**Priority**: High  
**Complexity Score**: 6/10  
**Estimated Hours**: 8h  

## Description

Build complete React-based frontend UI for user profile management including profile edit form, privacy settings interface, notification preferences, password change modal, and profile picture upload with cropping. All components must be mobile-responsive, accessible (WCAG 2.1 AA), and follow the design system.

## Acceptance Criteria

- [ ] Profile Settings page with tab navigation (Profile, Privacy, Notifications, Password)
- [ ] Profile tab shows editable form with all fields (name, email, bio, location, website)
- [ ] Real-time validation with clear error messages
- [ ] Profile picture upload with drag-drop and click-to-upload
- [ ] Image crop modal with preview before upload
- [ ] Upload progress indicator during image processing
- [ ] Privacy tab with toggle switches for each field
- [ ] "Preview Public Profile" feature works correctly
- [ ] Notifications tab with organized toggle groups (Email, Push)
- [ ] Password change modal with strength meter
- [ ] Unsaved changes warning when navigating away
- [ ] Success/error toast notifications for all actions
- [ ] Loading states for all async operations
- [ ] Mobile-responsive design (< 640px, 640-1024px, > 1024px)
- [ ] Keyboard navigation works throughout
- [ ] Screen reader compatible (tested with NVDA/JAWS)
- [ ] All interactive elements meet 44px minimum touch target
- [ ] E2E tests cover critical user flows

## Technical Details

### Component Structure

```
ProfileSettingsPage/
├── ProfileTab/
│   ├── ProfileForm (edit mode + view mode)
│   ├── AvatarUpload
│   └── FieldValidation
├── PrivacyTab/
│   ├── PrivacyToggleList
│   └── PublicProfilePreview
├── NotificationsTab/
│   └── NotificationToggleGroup
├── PasswordTab/
│   └── PasswordChangeModal
└── Shared/
    ├── TabNavigation
    ├── LoadingSpinner
    ├── Toast
    └── UnsavedChangesModal
```

### State Management

```typescript
interface ProfileState {
  profile: UserProfile;
  privacy: PrivacySettings;
  notifications: NotificationPreferences;
  ui: {
    isLoading: boolean;
    isSaving: boolean;
    activeTab: 'profile' | 'privacy' | 'notifications' | 'password';
    errors: Record<string, string>;
    unsavedChanges: boolean;
    showPasswordModal: boolean;
    showCropModal: boolean;
  };
}
```

### Form Validation

**Client-Side Validation (Yup schema):**
```typescript
const profileSchema = yup.object({
  full_name: yup.string()
    .min(2, 'Name must be at least 2 characters')
    .max(100, 'Name too long')
    .required('Name is required'),
  email: yup.string()
    .email('Invalid email address')
    .max(255, 'Email too long')
    .required('Email is required'),
  bio: yup.string()
    .max(500, 'Bio must be under 500 characters'),
  location: yup.string()
    .max(100, 'Location too long'),
  website: yup.string()
    .url('Invalid URL')
    .max(255, 'URL too long')
});
```

**Password Validation:**
```typescript
const passwordSchema = yup.object({
  current_password: yup.string()
    .required('Current password required'),
  new_password: yup.string()
    .min(8, 'Password must be at least 8 characters')
    .matches(/[A-Z]/, 'Must contain uppercase letter')
    .matches(/[a-z]/, 'Must contain lowercase letter')
    .matches(/[0-9]/, 'Must contain number')
    .matches(/[^A-Za-z0-9]/, 'Must contain special character')
    .required('New password required'),
  new_password_confirm: yup.string()
    .oneOf([yup.ref('new_password')], 'Passwords must match')
    .required('Please confirm password')
});
```

### API Integration

**Axios Instance:**
```typescript
const api = axios.create({
  baseURL: '/api/v1',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${getToken()}`
  }
});

// Interceptors for error handling and loading states
api.interceptors.request.use(onRequest);
api.interceptors.response.use(onSuccess, onError);
```

### Accessibility Requirements

1. **Keyboard Navigation:**
   - Tab order follows visual flow
   - Escape key closes modals
   - Enter submits forms
   - Arrow keys navigate tabs

2. **Screen Reader Support:**
   - Proper ARIA labels on all inputs
   - Form errors announced with aria-live
   - Loading states announced
   - Tab changes announced

3. **Visual Accessibility:**
   - Color contrast ratio ≥ 4.5:1
   - Focus indicators clearly visible (2px blue outline)
   - Error messages have both color and icon
   - Text resizable to 200%

4. **Touch Targets:**
   - All buttons/toggles ≥ 44px height
   - Adequate spacing between interactive elements (12px minimum)

### Responsive Breakpoints

**Mobile (< 640px):**
- Single column layout
- Full-width form inputs
- Stacked buttons
- Simplified avatar display (80px)

**Tablet (640-1024px):**
- Two-column layout where appropriate
- Larger form inputs
- Side-by-side buttons
- Medium avatar (100px)

**Desktop (> 1024px):**
- Three-column layout with sidebar
- Fixed-width form (720px max)
- Full-size avatar (120px)
- Hover states active

## Dependencies

- **ENG-002** - Profile API endpoints must be complete
- **ENG-004** - Privacy API endpoints must be complete

## Testing Requirements

### E2E Tests (Playwright)

```typescript
describe('Profile Settings UI', () => {
  test('complete profile edit flow', async ({ page }) => {
    await page.goto('/settings/profile');
    await page.click('[data-testid="edit-profile"]');
    await page.fill('[name="full_name"]', 'Updated Name');
    await page.fill('[name="bio"]', 'New bio text');
    await page.click('[data-testid="save-changes"]');
    await expect(page.locator('.toast-success')).toBeVisible();
  });

  test('profile picture upload with crop', async ({ page }) => {
    await page.goto('/settings/profile');
    await page.setInputFiles('[name="profile-picture"]', 'test-image.jpg');
    await expect(page.locator('[data-testid="crop-modal"]')).toBeVisible();
    await page.click('[data-testid="confirm-upload"]');
    await expect(page.locator('.upload-progress')).toBeVisible();
    await expect(page.locator('.toast-success')).toBeVisible();
  });

  test('privacy settings toggle', async ({ page }) => {
    await page.goto('/settings/privacy');
    await page.click('[data-testid="privacy-toggle-email"]');
    await expect(page.locator('[data-testid="email-privacy-status"]'))
      .toHaveText('Private');
  });

  test('password change flow', async ({ page }) => {
    await page.goto('/settings/profile');
    await page.click('[data-testid="change-password"]');
    await page.fill('[name="current_password"]', 'OldPass123!');
    await page.fill('[name="new_password"]', 'NewPass456!');
    await page.fill('[name="new_password_confirm"]', 'NewPass456!');
    await page.click('[data-testid="submit-password-change"]');
    await expect(page.locator('.toast-success')).toBeVisible();
  });

  test('unsaved changes warning', async ({ page }) => {
    await page.goto('/settings/profile');
    await page.click('[data-testid="edit-profile"]');
    await page.fill('[name="full_name"]', 'Changed Name');
    page.on('dialog', dialog => expect(dialog.message()).toContain('unsaved'));
    await page.click('[data-testid="privacy-tab"]');
  });
});
```

### Manual Test Scenarios

1. **Profile Edit Flow:**
   - Edit all fields → Save → Verify persistence
   - Enter invalid email → Verify error message
   - Leave required field empty → Verify validation
   - Edit then cancel → Verify changes discarded

2. **Image Upload:**
   - Upload 2MB JPEG → Verify success
   - Upload 6MB file → Verify error
   - Upload and crop → Verify preview
   - Remove profile picture → Verify removal

3. **Privacy Controls:**
   - Toggle each privacy setting → Verify saves
   - Preview public profile → Verify correct visibility
   - Change multiple settings → Verify all save

4. **Responsive Design:**
   - Test on iPhone SE (375px) → Verify usability
   - Test on iPad (768px) → Verify layout
   - Test on desktop (1440px) → Verify full features

5. **Accessibility:**
   - Navigate entire form with Tab key
   - Use screen reader to complete task
   - Verify color contrast with inspector
   - Test with keyboard only (no mouse)

## Implementation Checklist

- [ ] Create React components for all screens
- [ ] Implement Formik forms with Yup validation
- [ ] Add profile picture upload with browser-image-compression
- [ ] Implement image crop modal (use react-easy-crop)
- [ ] Add tab navigation with React Router
- [ ] Implement toast notifications (use react-hot-toast)
- [ ] Add loading states and spinners
- [ ] Implement unsaved changes detection
- [ ] Add responsive CSS (use Tailwind or CSS modules)
- [ ] Implement accessibility features (ARIA labels, keyboard nav)
- [ ] Create E2E tests with Playwright
- [ ] Test on multiple browsers (Chrome, Firefox, Safari)
- [ ] Test on mobile devices (iOS, Android)
- [ ] Run accessibility audit (axe DevTools)
- [ ] Code review
- [ ] QA testing
- [ ] Deploy to staging
- [ ] User acceptance testing
- [ ] Deploy to production

## Files to Create/Modify

**New Files:**
- `src/pages/ProfileSettingsPage.tsx`
- `src/components/Profile/ProfileForm.tsx`
- `src/components/Profile/AvatarUpload.tsx`
- `src/components/Profile/ImageCropModal.tsx`
- `src/components/Privacy/PrivacyToggleList.tsx`
- `src/components/Notifications/NotificationToggleGroup.tsx`
- `src/components/Password/PasswordChangeModal.tsx`
- `src/components/Shared/TabNavigation.tsx`
- `src/components/Shared/Toast.tsx`
- `src/components/Shared/UnsavedChangesModal.tsx`
- `src/hooks/useProfileForm.ts`
- `src/hooks/useImageUpload.ts`
- `src/utils/imageCompression.ts`
- `src/styles/ProfileSettings.css`
- `tests/e2e/profileSettings.spec.ts`

**Modified Files:**
- `src/App.tsx` (add route)
- `src/api/profile.ts` (add API calls)
- `package.json` (add frontend dependencies)

## Reference Documents

- Design Brief: All wireframes and visual specifications
- UX Designer Output: User flows and interaction patterns
- PRD: All Job Stories for acceptance criteria

## Notes

- Use existing design system components where possible
- Follow React best practices (hooks, context, memoization)
- Keep components small and focused (< 200 lines)
- Use TypeScript for type safety
- Optimize images with lazy loading
- Consider adding skeleton loaders for better perceived performance
- Monitor bundle size (code splitting recommended)
- Use React.lazy for route-based code splitting

## Risks & Mitigation

**Risk**: Poor mobile experience  
**Mitigation**: Mobile-first design approach, extensive mobile testing

**Risk**: Accessibility issues block some users  
**Mitigation**: Use axe DevTools, manual testing with screen readers

**Risk**: Large bundle size impacts load time  
**Mitigation**: Code splitting, lazy loading, tree shaking

**Risk**: Complex state management causes bugs  
**Mitigation**: Use TypeScript, comprehensive tests, React DevTools debugging

