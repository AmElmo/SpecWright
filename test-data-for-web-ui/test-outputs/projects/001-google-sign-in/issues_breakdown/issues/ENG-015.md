# Write E2E tests for sign-in flow

**Issue ID**: ENG-015  
**Status**: pending  
**Priority**: low  
**Category**: testing  
**Complexity Score**: 8/10  
**Estimated Hours**: 10h  
**Complexity Reasoning**: Complex E2E setup with browser automation and OAuth flow mocking

> **Status Options**: `pending` (not started) | `in-review` (AI completed, needs human review) | `approved` (human verified)

## Description

Test complete user journey with Playwright or Cypress, including clicking sign-in button, OAuth redirect, and returning to application authenticated.

## Technical Details

E2E tests should cover:
- User clicks "Sign in with Google"
- Redirect to Google handled
- User approves permissions
- Callback handled correctly
- User lands on dashboard authenticated
- User can access protected pages
- Logout works correctly

```typescript
describe('Google Sign-In E2E', () => {
  it('signs in user successfully', async () => {
    await page.goto('/');
    
    // Click sign-in button
    await page.click('[data-testid="google-signin"]');
    
    // Handle Google OAuth (mocked)
    await page.waitForURL('**/auth/google/callback**');
    
    // Verify redirect to dashboard
    await expect(page).toHaveURL('/dashboard');
    
    // Verify user name displayed
    await expect(page.locator('[data-testid="user-name"]'))
      .toBeVisible();
  });
  
  it('signs out user', async () => {
    // Sign in first
    await signInTestUser();
    
    // Click logout
    await page.click('[data-testid="logout-button"]');
    
    // Verify redirect to home
    await expect(page).toHaveURL('/');
    
    // Verify can't access protected page
    await page.goto('/dashboard');
    await expect(page).toHaveURL('/login');
  });
});
```

## Dependencies

- **ENG-008**: OAuth callback must be complete
- **ENG-011**: Error handling must be in place

## Acceptance Criteria

- [ ] Playwright/Cypress configured
- [ ] Sign-in flow tested end-to-end
- [ ] Google OAuth mocked for consistent testing
- [ ] Protected route access tested
- [ ] Logout flow tested
- [ ] Error scenarios tested
- [ ] Tests record videos on failure
- [ ] Tests run in CI/CD
- [ ] Tests are stable and don't flake

## Test Strategy

### Automated Tests

- Complete sign-in flow
- Access protected page after auth
- Logout flow
- Try accessing protected page without auth
- Session persistence across page refreshes
- Error handling (denied permissions)
- Mobile viewport testing

### Manual Verification (Human-in-the-Loop)

1. Run E2E test suite locally
2. Watch tests execute in browser
3. Verify test videos captured on failures
4. Check tests run in CI/CD
5. Verify no flaky tests

## Subtasks

1. Install Playwright or Cypress
2. Configure E2E test environment
3. Mock Google OAuth for E2E
4. Write sign-in flow test
5. Write protected route tests
6. Write logout test
7. Add error scenario tests
8. Configure video recording
9. Add to CI/CD pipeline
10. Document E2E test approach

---

**Notes**: Mock Google OAuth in E2E to avoid dependency on external service. Consider visual regression testing for UI changes.




